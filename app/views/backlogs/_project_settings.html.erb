<%
# We cannot rely on rb_form_helper being present here
#  - in case there is another plugin hooking into ProjectsHelpers - e.g. RemindCRM
# so we duplicate the rb_form_for code here and do not monkeypatch RbFormHelper into ProjectsHelper.
  def rb_pr_form_for(*args, &proc)
    form_string = form_for(*args, &proc)
    if Rails::VERSION::MAJOR < 3
      form_string
    else
      concat(form_string)
    end
  end
  rb_pr_form_for @project,
                   :as => :rb_project_settings,
                   :url => { :controller => 'rb_project_settings',
                             :action => 'project_settings', :project_id => @project },
                   :html => {:id => 'backlogs-form',
                             :method => :post} do |f| %>

<%= error_messages_for 'rb_project_settings' %>

<div class="box">
<% if Backlogs.setting[:sharing_enabled] %>
  <p>
    <%= content_tag(:label, l(:backlogs_show_stories_from_subprojects_in_backlog)) %>
    <%= check_box_tag("settings[show_stories_from_subprojects]", 'enabled',
        @project.rb_project_settings.show_stories_from_subprojects) %>
  </p>
<% end %>
<p>
  <%= content_tag(:label, l(:backlogs_show_in_scrum_stats)) %>
  <%= check_box_tag("settings[show_in_scrum_stats]", 'enabled',
      @project.rb_project_settings.show_in_scrum_stats) %>
</p>
<p>
  <%
    global_tracker_option = Tracker.new
    global_tracker_option.id = 0
    global_tracker_option.name = l(:backlogs_use_globally_selected_default_story_tracker_for_project)

    trackers = [global_tracker_option]
    trackers += [*@project.trackers]
  %>
  <%= content_tag(:label, l(:backlogs_default_story_tracker)) %>
  <%= select_tag("settings[default_story_tracker]",
      options_from_collection_for_select(trackers, :id, :name, @project.rb_project_settings.default_story_tracker)) %>
  <%= content_tag(:label, l(:backlogs_note_for_default_story_tracker_for_project)) %>
</p>
</div>
<%= submit_tag(l(:button_save)) %>
<% end %>
